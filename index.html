<?php
// index.php – Web sencilla para jugar ajedrez (local, 2 jugadores)
?>
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ajedrez Web</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;background:#222;color:#eee;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
#app{display:flex;gap:20px}
#board{display:grid;grid-template-columns:repeat(8,70px);grid-template-rows:repeat(8,70px);border:4px solid #555}
.square{width:70px;height:70px;display:flex;justify-content:center;align-items:center;font-size:42px;cursor:pointer;user-select:none}
.white{background:#f0d9b5}
.black{background:#b58863}
.square.selected{outline:4px solid #00e5ff}
#panel{min-width:220px}
#panel h2{margin-top:0}
button{padding:10px 14px;font-size:14px;cursor:pointer}
</style>
</head>
<body>
<div id="app">
  <div id="board"></div>
  <div id="panel">
    <h2>Ajedrez</h2>
    <p>Turno: <strong id="turn">Blancas</strong></p>
    <button onclick="resetGame()">Reiniciar</button>
    <p style="font-size:12px;opacity:.8">Juego local (sin IA). Reglas básicas.</p>
  </div>
</div>
<script>
// Piezas Unicode
const PIECES = {
  'r':'♜','n':'♞','b':'♝','q':'♛','k':'♚','p':'♟',
  'R':'♖','N':'♘','B':'♗','Q':'♕','K':'♔','P':'♙'
};

let boardEl = document.getElementById('board');
let turnEl = document.getElementById('turn');
let selected = null;
let turn = 'white';

let board = [];

function initBoard(){
  board = [
    ['r','n','b','q','k','b','n','r'],
    ['p','p','p','p','p','p','p','p'],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['P','P','P','P','P','P','P','P'],
    ['R','N','B','Q','K','B','N','R'],
  ];
}

function render(){
  boardEl.innerHTML='';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const sq = document.createElement('div');
      sq.className = 'square ' + ((r+c)%2===0?'white':'black');
      sq.dataset.r=r; sq.dataset.c=c;
      const p = board[r][c];
      if(p) sq.textContent = PIECES[p];
      if(selected && selected.r==r && selected.c==c) sq.classList.add('selected');
      sq.onclick = ()=>onSquare(r,c);
      boardEl.appendChild(sq);
    }
  }
  turnEl.textContent = turn==='white'?'Blancas':'Negras';
}

function isWhite(p){ return p && p===p.toUpperCase(); }
function isBlack(p){ return p && p===p.toLowerCase(); }

function onSquare(r,c){
  const p = board[r][c];
  if(selected){
    if(moveAllowed(selected.r,selected.c,r,c)){
      board[r][c] = board[selected.r][selected.c];
      board[selected.r][selected.c] = '';
      turn = turn==='white'?'black':'white';
    }
    selected = null;
  } else {
    if(p && ((turn==='white' && isWhite(p)) || (turn==='black' && isBlack(p)))){
      selected = {r,c};
    }
  }
  render();
}

function moveAllowed(sr,sc,dr,dc){
  const p = board[sr][sc];
  const target = board[dr][dc];
  if(target && (isWhite(p)===isWhite(target))) return false;
  const dR = dr-sr, dC = dc-sc;
  switch(p.toLowerCase()){
    case 'p':{
      const dir = isWhite(p)?-1:1;
      if(dC===0 && !target && dR===dir) return true;
      if(Math.abs(dC)===1 && dR===dir && target) return true;
      return false;
    }
    case 'r': return clearPath(sr,sc,dr,dc) && (dR===0||dC===0);
    case 'b': return clearPath(sr,sc,dr,dc) && Math.abs(dR)===Math.abs(dC);
    case 'q': return clearPath(sr,sc,dr,dc) && (dR===0||dC===0||Math.abs(dR)===Math.abs(dC));
    case 'n': return (Math.abs(dR)==2&&Math.abs(dC)==1)||(Math.abs(dR)==1&&Math.abs(dC)==2);
    case 'k': return Math.abs(dR)<=1 && Math.abs(dC)<=1;
  }
  return false;
}

function clearPath(sr,sc,dr,dc){
  const stepR = Math.sign(dr-sr);
  const stepC = Math.sign(dc-sc);
  let r = sr+stepR, c = sc+stepC;
  while(r!==dr || c!==dc){
    if(board[r][c]) return false;
    r+=stepR; c+=stepC;
  }
  return true;
}

function resetGame(){
  selected=null; turn='white'; initBoard(); render();
}

initBoard(); render();
</script>
</body>
</html>
